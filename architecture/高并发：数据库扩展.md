# 数据库连接池

使用数据库连接池减少频繁创建连接带来的损耗

连接池两个重要的参数：
- 最小连接数
- 最大连接数

获取连接的流程：
- 池中连接数小于最小连接数，创建新的连接返回
- 池中有空闲连接返回空闲连接
- 池中没有空闲连接，但前连接数小于最大连接数，创建新的连接返回
- 池中没有连接，并且连接数达到最大连接数，按照配置等待时间，等待旧的连接可用
- 等待超过配置时间，抛出错误

# 主从读写分离

关键点：
1. 主从复制
2. 屏蔽主从分离带来的访问方式

## 主从复制

### 原理
1. 从库创建i/o线程和主库建立连接，并请求主库binlog写入relay log
2. 主库也会创建一个log dumpe发送binlog给从库
3. 从库创建一个sql线程读取relay log在从库做回放

### 主从延迟
1. 数据冗余，在发送消息队列时发送全部数据
2. 使用缓存，在写主库的同时写入到缓存中
3. 最后查询主库


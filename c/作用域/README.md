# extern

定义: 外部变量是指在函数或者文件外部定义的全局变量, 外部变量定义必须在所有的函数之外, 且只能定义一次

1) 在一个文件内声明的外部变量

作用域: 如果在变量定义之前要使用该变量, 在用之前加 `extren` 声明变量, 作用域扩展到从声明开始, 到文件结束

```
#include <stdio.h>

int max(int x, int y); // 函数提前声明
int main(int argc, char *argv[])
{
	int result;
	extern int X;
	extern int Y;
	result = max(X, Y);
	printf("the max value is %d\n", result);
	return 0;
}

int X = 10; //定义外部变量
int Y = 20;

int max(int x, int y)
{
	return (x > y ? x : y);
}
```

2) 在多个文件中声明外部变量

作用域: 如果整个工程有多个文件组成, 在一个文件中想引用另外一个文件中已经定义的外部变量时,
则只需在引用变量的文件中用 `extern` 关键字加以声明即可, 可见其作用域从一个文件扩展到多个文件了


文件 a.c 的内容
```
#include <stdio.h>
int BASE = 2;
extern int exe(int x);

int main(int argc, char *argv[])
{
	int a = 10;
	printf("%d^%d = %d\n", BASE, a, exe(a));
	return 0;
}
```

文件 b.c 的内容
```
#include <stdio.h>
extern BASE; // 声明的外部变量
int exe(int x)
{
	int i;
	int ret = 1;
	for (i = 0; i < x; i++) {
		ret *= BASE;
	}

	return ret;
}
```

利用gcc 工具编译 `gcc a.c b.c -o demo` , 再运行 `./demo`, 结果为 `2^10 = 1024 .`
其中，在a.c 文件中定义 `BASE = 2`, 在 b.c 中引用 BASE 时，需要用 extern 关键字声明其为外部变量，否则编译会找不到该变量.

实际工程中，对于模块化的程序文件，在其文件中可以预先留好外部变量的接口，也就是只采用 extern 声明变量，不定义变量，
也通常在模块程序的头文件中声明，在使用该模块时，只需要在使用时定义一下即可，如上述 b.c 文件，做好相应的函数接口，
留好需要改变 BASE 值的声明，在需要使用该模块时，只需要在需要调用的文件中定义具体的值即可。

引用外部变量和通过函数形参值传递变量的区别：用extern 引用外部变量，可以在引用的模块内修改其值，而形参值传递的变量则不能修改其值，除非是地址传递。

3) 在多个文件中声明外部结构体变量
在多个文件中声明外部变量,只是适合一般变量的外部声明,但是对于声明外部结构体变量时, 则有些不同,
如果调用外部结构等多层结构体变量是, 需要对这种变量进行实现, 实现时, 加上模块的头文件即可, 否则会报错


4) 用extern声明外部函数

- 定义函数时, 在函数的返回值类型前面加上 extern 关键字, 表示此函数是外部函数, 可供其他文件调用, 如:
`extern int func(int x, int y)`, c语言规定, 此时 `extern` 可以省略, 隐形为外部函数
- 调用次函数时, 需要用 `extern` 对函数做出声明


总结:

`.c` 文件中实现函数, `.h`文件中声明函数接口, 需要调用`.c`文件的函数接口时, 只需包含`.h`文件即可;

实际工程中, 两种情况比较多:
- 一是利用 `extern` 只声明外部函数, 不需要传递需要外部声明的变量,
一个模块化接口文件对应一个声明接口的头文件, 需要调用接口函数时, 需要包含头文件,
- 二是利用 `extern` 声明外部函数, 同时声明需要传递的外部变量, 做法和第一种情况一样, 声明都放在头文件中, 但是模块文件也需要包含改头文件,
如果结构体等比较复杂的变量, 则需要包含其定义的头文件, 另外, 定义的外部变量属于全局变量, 存储方式为静态存储, 生存周期为整个生存周期

# 预处理

## 预处理的工作方式

#### 预编译作用
1. 将源文件中以 "include" 格式包含的文件复制到编译的源文件中
2. 用实际值替换用 "#define" 定义的字符串
3. 根据 "#if" 后面的条件决定需要编译的代码

#### 工作方式
预处理的行为由指令控制

`#define` 指令定义了一个宏 -- 用来代表其他东西的一个命令, 通常是某一个类型的常量,预处理器会通过将宏的名字和他的定义
存储在去\一起来响应`#define`指令, 当这个宏在后面的程序中使用到时, 预处理器扩展了宏, 将宏替换为他所定义的值

`#include` 告诉预处理器打开一个特定的文件, 将它的内容作为正在编译的文件的一部分"包含进来"

## 预处理指令

#### 指令类型

|指令         |用途     |
|:--          |:--    |
|#include       | 包含一个源代码文件|
|#define        | 定义宏           |
|#undef         | 取消已定义的宏   |
|#if            | 如果给定条件为真，则编译下面代码|
|#ifdef         | 如果宏已经定义，则编译下面代码|
|#ifndef        | 如果宏没有定义，则编译下面代码|
|#elif          | 如果前#if条件不为真，当前条件为真，则编译下面代码，其实就是else if的简写|
|#endif         | 结束一个#if……#else条件编译块|
|#error         | 停止编译并显示错误信息|

## 特殊符号
|指令         |用途     |
|:--          |:--    |
|`__FILE__`     | 包含当前文件的字符串 |
|`__LINE__`     | 表示当前行号的整数   |
|`__DATE__`     | 表示当前日期的字符串 |
|`__TIME__`     | 表示当前时间的字符串 |


# 宏定义

### 定义:

宏定义又称为宏代换宏替换, 预处理(预编译)工作也称为宏展开, 将宏名替换为字符串, 即在对相关命令 或 语句语义分析 和 功能 做具体
做具体分析之前就要替换

### 不带参数

1. 宏名一般用大写
2. 使用宏可提高程序的通用性可读性, 减少不一致性, 减少输入错误和便于修改,
3. 预处理是在编译之前的处理, 而编译工作的任务之一就是语法检查, 预处理不做语法检查
4. 宏定义末尾不加分号
5. 宏定义写在函数的花括号外边, 作用域为其后的程序, 通常在文件的最开头
6. 可以用 #undef 命令终止宏定义的作用域
7. 宏定义允许嵌套
8. 字符串("")中永远不包含宏
9. 宏定义不分配内存, 变量定义分配内存
10. 宏定义不存在类型问题, 他的参数也是无类型的

### 带参数
格式:  `#define 宏名 (参数表) 字符串`

1. 实参如果是变大时容易出问题
2. 宏名和参数的括号间不能有空格;
3. 宏替换制作替换, 不做计算, 不做表达式求解
4. 函数调用在编译后程序运行时进行, 并且分配内存, 宏替换在编译前进行, 不分配内存
5. 宏的雅诗结合不存在类型, 也没有类型转换
6. 宏展开是源程序变长, 函数调用不会
7. 宏展开不占运行时间, 只占编译时间, 函数调用站运行时间
8. `#define STR(str) #str  ` # 用于把宏定义中的参数两端加上字符串的 ""

# 文件包含

### 定义:
文件包含处理是指在一个源文件中, 通过文件包含命令将另一个源文件的内容全部包含在此文件中国, 在源文件编译时,
连同被包含进来的文件一同编译, 生成目标目标文件;

### 文件包含的处理方法:
1. 处理时间: 文件包含也是以 '#' 开头来写的, 是预处理阶段进行的
2. 处理方法: 在预处理阶段, 系统自动对 `#include` 命令进行处理, 具体做法是: 将包含文件的内容复制到包含语句处, 得到新的文件
然后在对这个新的文件进行编译

### 格式:
```
#include "文件名"

#include <文件名>
```

> 区别: 双引号, 首先在用户当前目录中寻找要包含的文件, 为找到才到包含目录中去查找; \
使用尖括号, 在包含目录中查找(包含目录是由用户在设置环境是设置的), 不在源文件目录去查找, 若文件不在当前目录中, 双引号内可给出文件路径

1. 对应的 `.c` 文件中写变量,函数的定义
2. 对应的 `.h` 文件中写变量,函数的声明
3. 如果有数据类型的定义和宏定义, 写在头文件 (.h) 中
4. 头文件中一定加上 `#ifdef #define #endif` 之类的防止头文件被重包含的语句
5. 模块的`.c`文件中别忘包含自己的`.h`文件


# 条件编译
通过定义不同的宏来决定编译程序对哪些代码进行处理, 条件编译指令将决定哪些代码被编译, 哪些不被编译,
可以根据表达式的值或者某个特定的宏是否被定义来确定编译条件
```
#ifdef 宏名
// 语句段
#endif
如果在此之前已定义了这样的宏名, 则编译语句段

#ifndef 宏名
// 语句段
#endif
如果在此之前没有定义这样的宏名, 则编译语句段

```

防止头文件重复包含
```
#ifndef FUNCA_H
#define FUNCA_H
#endif
```

`#error` 命令是c/c++语言的预处理命令之一, 当预处理预处理到`#error`命令是将停止编译并输出用户自定义的错误消息
```
#error [用户自定义的错误消息]
```

`#line` 指令改变LINE与FILE的内容, 他们是编译程序中预先定义的标识符
```
#include <stdio.h>
#line 100 // 初始化行计数器

int main(int argc, const char * argv[]) {

    printf("Hello world!\n");

    printf("%d\n", __LINE__); // 105


    return 0;
}

```
















